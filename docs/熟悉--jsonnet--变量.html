<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>变量</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>变量</h1><br/><h3>变量</h3><br /><br />local关键字定义变量<br />全局变量用;结尾<br />局部变量用,结尾<br /><br />官网的原文<br />• Variables defined next to fields end with a comma (<code>,</code>).<br />• All other cases end with a semicolon (<code>;</code>).<br /><br /><br /><div class="codebox"><div class="codebox">[root@centos7&nbsp;jsonnet_learn]#&nbsp;<span style="color:#ff9d00;font-weight:700">cat</span>&nbsp;test_a.jsonnet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><span style="color:#ff9d00;font-weight:700">local</span>&nbsp;house_rum&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">&#39;Banks&nbsp;Rum&#39;</span><span style="color:#ff9d00;font-weight:700">;</span><br /><br /><span style="color:#ff9d00;font-weight:700">{</span><br />akey<span style="color:#ff9d00;font-weight:700">:{</span><br />&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">local</span>&nbsp;pour&nbsp;=&nbsp;1.5,<br /><br />&nbsp;&nbsp;Daiquiri<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;<span style="color:#ff9d00;font-weight:700">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;ingredients<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">{</span>&nbsp;kind<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;house_rum,&nbsp;qty<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;pour&nbsp;<span style="color:#ff9d00;font-weight:700">}</span>,]<span style="color:#ff9d00;font-weight:700">}}</span>,<span style="color:#ff9d00;font-weight:700">}</span><br />[root@centos7&nbsp;jsonnet_learn]#&nbsp;jsonnet&nbsp;test_a.jsonnet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><span style="color:#ff9d00;font-weight:700">{</span><br />&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">&quot;akey&quot;</span><span style="color:#ff9d00;font-weight:700">:</span>&nbsp;<span style="color:#ff9d00;font-weight:700">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">&quot;Daiquiri&quot;</span><span style="color:#ff9d00;font-weight:700">:</span>&nbsp;<span style="color:#ff9d00;font-weight:700">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">&quot;ingredients&quot;</span><span style="color:#ff9d00;font-weight:700">:</span>&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">&quot;kind&quot;</span><span style="color:#ff9d00;font-weight:700">:</span>&nbsp;<span style="color:#3ad900;font-weight:400">&quot;Banks&nbsp;Rum&quot;</span>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">&quot;qty&quot;</span><span style="color:#ff9d00;font-weight:700">:</span>&nbsp;1.5<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">}</span><br />&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">}</span><br /><span style="color:#ff9d00;font-weight:700">}</span></div></div><br /><br />尝试了下局部变量用分号结尾，结果报错<br /><div class="codebox"><div class="codebox">[root@centos7&nbsp;jsonnet_learn]#&nbsp;<span style="color:#ff9d00;font-weight:700">cat</span>&nbsp;test_a.jsonnet&nbsp;<br /><span style="color:#ff9d00;font-weight:700">local</span>&nbsp;house_rum&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">&#39;Banks&nbsp;Rum&#39;</span><span style="color:#ff9d00;font-weight:700">;</span><br /><span style="color:#ff9d00;font-weight:700">local</span>&nbsp;house_ruma&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">&#39;Banks&nbsp;Ruma&#39;</span><span style="color:#ff9d00;font-weight:700">;</span><br /><span style="color:#ff9d00;font-weight:700">local</span>&nbsp;house_rumb&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">&#39;Banks&nbsp;Rumb&#39;</span><span style="color:#ff9d00;font-weight:700">;</span><br /><br /><span style="color:#ff9d00;font-weight:700">{</span><br />akey<span style="color:#ff9d00;font-weight:700">:{</span><br />&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">local</span>&nbsp;pour&nbsp;=&nbsp;1.5<span style="color:#ff9d00;font-weight:700">;</span><br /><br />&nbsp;&nbsp;Daiquiri<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;<span style="color:#ff9d00;font-weight:700">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;ingredients<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">{</span>&nbsp;kind<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;house_rum,&nbsp;qty<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;pour&nbsp;<span style="color:#ff9d00;font-weight:700">}</span>,]<span style="color:#ff9d00;font-weight:700">}}</span>,<span style="color:#ff9d00;font-weight:700">}</span><br />[root@centos7&nbsp;jsonnet_learn]#&nbsp;jsonnet&nbsp;test_a.jsonnet&nbsp;<br />STATIC&nbsp;ERROR<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;test_a.jsonnet<span style="color:#ff9d00;font-weight:700">:</span>7<span style="color:#ff9d00;font-weight:700">:</span>19<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;expected&nbsp;a&nbsp;comma&nbsp;before&nbsp;next&nbsp;field.</div></div><br />全局变量用都好结尾，结果也报错<br /><div class="codebox"><div class="codebox">[root@centos7&nbsp;jsonnet_learn]#&nbsp;<span style="color:#ff9d00;font-weight:700">cat</span>&nbsp;test_a.jsonnet&nbsp;<br /><span style="color:#ff9d00;font-weight:700">local</span>&nbsp;house_rum&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">&#39;Banks&nbsp;Rum&#39;</span>,<br /><span style="color:#ff9d00;font-weight:700">local</span>&nbsp;house_ruma&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">&#39;Banks&nbsp;Ruma&#39;</span><span style="color:#ff9d00;font-weight:700">;</span><br /><span style="color:#ff9d00;font-weight:700">local</span>&nbsp;house_rumb&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">&#39;Banks&nbsp;Rumb&#39;</span><span style="color:#ff9d00;font-weight:700">;</span><br /><br /><span style="color:#ff9d00;font-weight:700">{</span><br />akey<span style="color:#ff9d00;font-weight:700">:{</span><br />&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">local</span>&nbsp;pour&nbsp;=&nbsp;1.5,<br /><br />&nbsp;&nbsp;Daiquiri<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;<span style="color:#ff9d00;font-weight:700">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;ingredients<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">{</span>&nbsp;kind<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;house_rum,&nbsp;qty<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;pour&nbsp;<span style="color:#ff9d00;font-weight:700">}</span>,]<span style="color:#ff9d00;font-weight:700">}}</span>,<span style="color:#ff9d00;font-weight:700">}</span><br />[root@centos7&nbsp;jsonnet_learn]#&nbsp;jsonnet&nbsp;test_a.jsonnet&nbsp;<br />STATIC&nbsp;ERROR<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;test_a.jsonnet<span style="color:#ff9d00;font-weight:700">:</span>2<span style="color:#ff9d00;font-weight:700">:</span>1-6<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;expected&nbsp;token&nbsp;IDENTIFIER&nbsp;but&nbsp;got&nbsp;<span style="color:#ff9d00;font-weight:700">(</span>local,&nbsp;<span style="color:#3ad900;font-weight:400">&quot;local&quot;</span><span style="color:#ff9d00;font-weight:700">)</span></div></div><br /><br />局部变量只在自己的{}中生效，如果调用大括号外的变量，则报错<br /><div class="codebox"><div class="codebox">[root@centos7&nbsp;jsonnet_learn]#&nbsp;<span style="color:#ff9d00;font-weight:700">cat</span>&nbsp;test_e.jsonnet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><span style="color:#ff9d00;font-weight:700">local</span>&nbsp;house_rum&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">&#39;Banks&nbsp;Rum&#39;</span><span style="color:#ff9d00;font-weight:700">;</span><br /><br /><span style="color:#ff9d00;font-weight:700">{</span><br />akey<span style="color:#ff9d00;font-weight:700">:{</span><br />&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">local</span>&nbsp;pour&nbsp;=&nbsp;1.5,<br /><br />&nbsp;&nbsp;Daiquiri<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;<span style="color:#ff9d00;font-weight:700">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;ingredients<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">{</span>&nbsp;kind<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;house_rum,&nbsp;qty<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;pour&nbsp;<span style="color:#ff9d00;font-weight:700">}</span>,],<span style="color:#ff9d00;font-weight:700">}}</span>,<br />bkey<span style="color:#ff9d00;font-weight:700">:{</span><br />&nbsp;&nbsp;&nbsp;mykey<span style="color:#ff9d00;font-weight:700">:</span>pour,<br />&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">}</span>,<span style="color:#ff9d00;font-weight:700">}</span><br />[root@centos7&nbsp;jsonnet_learn]#&nbsp;jsonnet&nbsp;test_e.jsonnet&nbsp;<br />STATIC&nbsp;ERROR<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;test_e.jsonnet<span style="color:#ff9d00;font-weight:700">:</span>11<span style="color:#ff9d00;font-weight:700">:</span>10-14<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;Unknown&nbsp;variable<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;pour</div></div></div>
</body>
</html>
